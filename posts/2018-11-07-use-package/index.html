<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My ~/.emacs.d configuration used to be a mess.
For example, here are 2 old configurations for IDO and sidebar neotree.
;; ### IDO ##### (require 'ido) ;; enable IDO (ido-mode 1) (ido-everywhere 1) (ido-ubiquitous-mode 1) (setq ido-enable-flex-matching t) (setq ido-use-filename-at-point nil) (setq ido-auto-merge-work-directories-length -1) (setq ido-use-virtual-buffers t) ;; Shows a list of buffers (global-set-key (kbd &#34;C-x C-b&#34;) 'ibuffer) ;; #### Neo Tree ##### (require-package 'neotree) ;; Bind F8 to show the tree (global-set-key [f8] 'neotree-toggle) ;; slow rendering (setq inhibit-compacting-font-caches t) ;; set icons theme (setq neo-theme (if (display-graphic-p) 'icons 'arrow)) ;; Every time when the neotree window is opened, let it find current file and jump to node (setq neo-smart-open t) ;; When running ‘projectile-switch-project’ (C-c p p), ‘neotree’ will change root automatically (setq projectile-switch-project-action 'neotree-projectile-action) ;; show hidden files (setq-default neo-show-hidden-files t) Both are identical for some configurations:"><title>use-package for a tidy .emacs.d
</title><link rel="shortcut icon" type=image/x-icon href=/><link rel=stylesheet href=/css/main.c5af9bae99b4a3d315b9f39305ffff27e9c3383fbbfd8b5fcaf2237667021a333a982fb958d1813a720b0a660b14022337553ae1ca93ef2ee17c4ae628ac19cb.css integrity="sha512-xa+brpm0o9MVufOTBf//J+nDOD+7/YtfyvIjdmcCGjM6mC+5WNGBOnILCmYLFAIjN1U64cqT7y7hfErmKKwZyw=="></head><body a=light><main class=page-content aria-label=Content><div class=w><a href=/>..</a><article><p class=post-meta><time datetime="2018-11-07 00:00:00 +0000 UTC">Feburary 11, 2018</time></p><h1>use-package for a tidy .emacs.d</h1><p>My <code>~/.emacs.d</code> configuration used to be a mess.</p><p>For example, here are 2 old configurations for <a href=https://www.emacswiki.org/emacs/InteractivelyDoThings>IDO</a> and sidebar <a href=https://github.com/jaypei/emacs-neotree>neotree</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span><span style=color:#75715e>;; ### IDO #####</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>require</span> <span style=color:#e6db74>&#39;ido</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; enable IDO</span>
</span></span><span style=display:flex><span>(ido-mode <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>(ido-everywhere <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>(ido-ubiquitous-mode <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> ido-enable-flex-matching <span style=color:#66d9ef>t</span>)
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> ido-use-filename-at-point <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> ido-auto-merge-work-directories-length <span style=color:#ae81ff>-1</span>)
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> ido-use-virtual-buffers <span style=color:#66d9ef>t</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; Shows a list of buffers</span>
</span></span><span style=display:flex><span>(global-set-key (kbd <span style=color:#e6db74>&#34;C-x C-b&#34;</span>) <span style=color:#e6db74>&#39;ibuffer</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span><span style=color:#75715e>;; #### Neo Tree #####</span>
</span></span><span style=display:flex><span>(require-package <span style=color:#e6db74>&#39;neotree</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; Bind F8 to show the tree</span>
</span></span><span style=display:flex><span>(global-set-key [f8] <span style=color:#e6db74>&#39;neotree-toggle</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; slow rendering</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> inhibit-compacting-font-caches <span style=color:#66d9ef>t</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; set icons theme</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> neo-theme (<span style=color:#66d9ef>if</span> (display-graphic-p) <span style=color:#e6db74>&#39;icons</span> <span style=color:#e6db74>&#39;arrow</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; Every time when the neotree window is opened, let it find current file and jump to node</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> neo-smart-open <span style=color:#66d9ef>t</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; When running ‘projectile-switch-project’ (C-c p p), ‘neotree’ will change root automatically</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> projectile-switch-project-action <span style=color:#e6db74>&#39;neotree-projectile-action</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; show hidden files</span>
</span></span><span style=display:flex><span>(setq-default neo-show-hidden-files <span style=color:#66d9ef>t</span>)
</span></span></code></pre></div><p>Both are identical for some configurations:</p><ul><li>Install a package, typically from <a href=https://melpa.org/packages/>MELPA</a> or <a href=https://www.emacswiki.org/emacs/MarmaladeRepo>Marmalade</a>.
And you have to do it <em>manually</em> by default. I used a little trick for auto installation if the required package is not yet installed.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span>(<span style=color:#a6e22e>require</span> <span style=color:#e6db74>&#39;package</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(defun require-package (<span style=color:#a6e22e>package</span>)
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;Install given PACKAGE if it was not installed before.&#34;</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>if</span> (package-installed-p <span style=color:#a6e22e>package</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>progn</span>
</span></span><span style=display:flex><span>      (unless (<span style=color:#a6e22e>assoc</span> <span style=color:#a6e22e>package</span> package-archive-contents)
</span></span><span style=display:flex><span>	(package-refresh-contents))
</span></span><span style=display:flex><span>      (package-install <span style=color:#a6e22e>package</span>))))
</span></span></code></pre></div><p>Replace <code>(require 'some-package)</code> with <code>(require-package 'some-package)</code> does the trick.</p><ul><li>Require package:</li></ul><table><thead><tr><th>IDO</th><th>neotree</th></tr></thead><tbody><tr><td><code>(require 'ido)</code></td><td><code>(require-package 'neotree)</code></td></tr></tbody></table><ul><li><p>Enable mode: (IDO) <code>(ido-mode 1)</code></p></li><li><p>Setup:</p></li></ul><table><thead><tr><th>IDO</th><th>neotree</th></tr></thead><tbody><tr><td><code>(setq ido-enable-flex-matching t)</code></td><td><code>(setq inhibit-compacting-font-caches t)</code></td></tr></tbody></table><ul><li>Bind keys:</li></ul><table><thead><tr><th>IDO</th><th>neotree</th></tr></thead><tbody><tr><td><code>(global-set-key (kbd "C-x C-b") 'ibuffer)</code></td><td><code>(global-set-key [f8] 'neotree-toggle)</code></td></tr></tbody></table><p>They all have the same indent level and repeat many times, thus trouble for productivity and readability. I want a more compact way of tidying my configuration.</p><h2 id=enter-use-packagehttpsgithubcomjwiegleyuse-package>Enter <a href=https://github.com/jwiegley/use-package><code>use-package</code></a></h2><p>It simply combines all those processes above into a single block of code.</p><p>Setup is simple:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span><span style=color:#75715e>;; Basic setup for package archives</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>require</span> <span style=color:#e6db74>&#39;package</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>setq</span> package-enable-at-startup <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>(add-to-list <span style=color:#e6db74>&#39;package-archives</span> <span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;melpa&#34;</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;http://melpa.org/packages/&#34;</span>))
</span></span><span style=display:flex><span>(add-to-list <span style=color:#e6db74>&#39;package-archives</span> <span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;marmalade&#34;</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;http://marmalade-repo.org/packages/&#34;</span>))
</span></span><span style=display:flex><span>(add-to-list <span style=color:#e6db74>&#39;package-archives</span> <span style=color:#f92672>&#39;</span>(<span style=color:#e6db74>&#34;gnu&#34;</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;http://elpa.gnu.org/packages/&#34;</span>))
</span></span><span style=display:flex><span>(package-initialize)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; use-package setup</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; install if not yet installed</span>
</span></span><span style=display:flex><span>(unless (package-installed-p <span style=color:#e6db74>&#39;use-package</span>)
</span></span><span style=display:flex><span>  (package-refresh-contents)
</span></span><span style=display:flex><span>  (package-install <span style=color:#e6db74>&#39;use-package</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(eval-when-compile
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>require</span> <span style=color:#e6db74>&#39;use-package</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>use-package</span> diminish
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:ensure</span> <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:defer</span> <span style=color:#66d9ef>t</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>use-package</span> bind-key
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:ensure</span> <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:defer</span> <span style=color:#66d9ef>t</span>)
</span></span></code></pre></div><p>And now the best part of <code>use-package</code> really shines. Enter my new setup for <code>IDO</code> and <code>neotree</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span><span style=color:#75715e>;; IDO</span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>use-package</span> ido
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:diminish</span> ido-mode
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:bind</span> (<span style=color:#e6db74>&#34;C-x C-b&#34;</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;ibuffer</span>)   <span style=color:#75715e>;; Shows a list of buffers</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:init</span>
</span></span><span style=display:flex><span>  (ido-everywhere <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>  (ido-ubiquitous-mode <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> ido-enable-flex-matching <span style=color:#66d9ef>t</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> ido-use-filename-at-point <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> ido-auto-merge-work-directories-length <span style=color:#ae81ff>-1</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> ido-use-virtual-buffers <span style=color:#66d9ef>t</span>))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span>(<span style=color:#a6e22e>use-package</span> neotree
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:ensure</span> <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:bind</span> (<span style=color:#e6db74>&#34;&lt;f8&gt;&#34;</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;neotree-toggle</span>)
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:init</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; slow rendering</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> inhibit-compacting-font-caches <span style=color:#66d9ef>t</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; set icons theme</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> neo-theme (<span style=color:#66d9ef>if</span> (display-graphic-p) <span style=color:#e6db74>&#39;icons</span> <span style=color:#e6db74>&#39;arrow</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; Every time when the neotree window is opened, let it find current file and jump to node</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> neo-smart-open <span style=color:#66d9ef>t</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; When running ‘projectile-switch-project’ (C-c p p), ‘neotree’ will change root automatically</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> projectile-switch-project-action <span style=color:#e6db74>&#39;neotree-projectile-action</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; show hidden files</span>
</span></span><span style=display:flex><span>  (setq-default neo-show-hidden-files <span style=color:#66d9ef>t</span>))
</span></span></code></pre></div><p>Neat! As you see, each package comes with its own territory.
It automatically installs and requires the package (<code>:ensure</code>), enable the mode (<code>:diminish</code>) and then loads the configuration (<code>:init</code>).</p><p>Such task as adding packages, add new features (<code>:init</code> or <code>:config</code>), bind keys (<code>:bind</code>), etc. now becomes very easy and productive.</p><p>You can check out more cool features of <code>use-package</code> on its <a href=https://github.com/jwiegley/use-package>README</a>.</p></article></div></main></body></html>